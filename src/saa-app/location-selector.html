<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<dom-module id="location-selector">
  <template>

    <style>
      :host {
        display: block;
        color: #333;
        font-size: 1.563rem;
        
        margin: 0 0 0.2rem 0;
	    	text-align: center;	    
      }
      .locationIcon {
        vertical-align: middle;
      }

    </style>
    
    <span class="locationIcon" on-click="_locate">
        <svg fill="#333" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
        </svg>
      </span>
    <span>[[place]] nyt</span>
    
  </template>

  <script>

    /**
     * @customElement
     * @polymer
     */
    class LocationSelector extends Polymer.Element {
      static get is() { return 'location-selector'; }
      
      static get properties() {
        return {
          place: {
            type: String,
            value: ''
          }
        };
      }

      _locate() {
      
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition( (position) => 
            {
              const latlon = position.coords.latitude + ',' + position.coords.longitude;

              var event = new CustomEvent('new-location', {detail: { latlon: latlon}, bubbles: true, composed: true});
              this.dispatchEvent(event);

            }, (error) =>
            {
              var event = new CustomEvent('locate-error', {detail: {text: 'salli paikannus nähdäksesi paikkakuntasi sää'}, bubbles: true, composed: true});
              this.dispatchEvent(event);     
            });
        } 
        else { 
          var event = new CustomEvent('locate-error', {detail: {text: 'paikantaminen epäonnistui, yritä uudelleen'}, bubbles: true, composed: true});
          this.dispatchEvent(event);
        }
      }  

      
    }

    window.customElements.define(LocationSelector.is, LocationSelector);
  </script>
</dom-module>
