<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">

<link rel="import" href="./ios-add-to-homescreen.html">
<link rel="import" href="./location-selector.html">
<link rel="import" href="./observation-data.html">

<link rel="import" href="./time-now.html">
<link rel="import" href="./weather-analytics.html">
<link rel="import" href="./forecast-data.html">

<link rel="import" href="./weather-days.html">
<link rel="import" href="./weather-icons.html">
<link rel="import" href="./weather-symbol-icons.html">

<link rel="import" href="./weather-now.html">
<link rel="import" href="./wind-now.html">

<dom-module id="weather-app">
  <template>

    <style>
      :host {
        display: block;
      
        /* don't use these directly (except below) */
        --color-palette-yellow: rgb(255,255,209);
        --color-palette-brown: rgb(145,108,37);
        --color-palette-orange: rgb(255,168,0);
        --color-palette-blue: rgb(0,96,232);
        --color-palette-lightBlue: rgb(132,185,255);

        /* pure black or white can be too hard, use these instead  */        
        --color-black: #111;
        --color-white: #fff;
        --color-darkGray: #555;        
        /* main colors */
        --color-primary: var(--color-palette-lightBlue);
        --color-secondary: var(--color-palette-yellow);
        --color-tertiary: #ddd;

        /* deprecated */
        --primary-color:#67a9cfab;
        --primary-color--light: #edfafd;
        --secondary-color: #ddd; /**/
        --tertiary-color:  #aed9da; 
        --background-color: #fff;
        --font-color: #111;
        --font-color-light: #fff;

        --rain-bar-color: var(--primary-color);
        --past-box-shadow: #fff;

      }

      header {
        background-color: var(--color-primary);
        padding: 1rem 1rem 0 1rem;
      }

      .empty {
        flex: 0 0 3rem;
      }

      .header-content {
        display: flex;
        justify-content: space-between;
      }

      h1 {
        margin: 0;
        
        font-size: 1.953rem;
        font-weight: inherit;
        
        padding: 0;
          
      }

      h2 {
        color: var(--color-white);
        font-size: 1.25rem;
        font-weight: 300;

        position: absolute;
        right: 1rem;
        top: -0.65rem;
      }
      
      footer {
        background-color: var(--color-primary);
        padding: 1rem;
        text-align: center;
      }
  
    </style>
    
    <weather-analytics key="UA-114081578-1"></weather-analytics>

    <!-- weather now data (observation) -->
    <observation-data
      observation-data="{{observationData}}"
      place="[[place]]">
    </observation-data> 

    
    <!-- rest of the data (forecast) -->
    <forecast-data 
      weather-location="[[weatherLocation]]"
      forecast-data="{{forecastData}}"
      weather-now-data="{{weatherNowData}}">
    </forecast-data>

    <!-- 'Espoo' (or any other city) now-->
    <paper-toast 
      id="locateError" 
      duration="5000">
    </paper-toast>

    <header>
      <div class="header-content">
        <div class="empty"></div>
        
        <div>
          <h1>
            <location-selector 
              place="[[place]]">
            </location-selector>
          </h1>
          
          <weather-now 
            observation-data=[[observationData]]
            weather-now-data="[[weatherNowData]]">
          </weather-now>

        </div>
        
        <wind-now 
          class="wind"
          observation-data=[[observationData]]
          weather-now-data="[[weatherNowData]]">
        </wind-now>

      </div>
        
      <time-now update-time="[[locationChanged]]"></time-now>

    </header>

    <!-- today, tomorrow and a day after tomorrow -->
    <main>
      <weather-days 
        forecast-data="[[forecastData]]"
        show-wind="[[showWind]]"></weather-days>
    </main>

    <!-- footer -->
    <footer>
      Säädata by Ilmatieteen laitos | avoin data

      <ios-add-to-homescreen></ios-add-to-homescreen>

    </footer>

  </template>

  <script>
    /**
     * @customElement
     * @polymer
     */
    class WeatherApp extends Polymer.Element {
      static get is() { return 'weather-app'; }
    
      static get properties() {
        return {
          locationChanged: {
            type: String,
          },
          place: {
            type: String,
          },
          showWind: {
            type: Boolean,
            value: false
          },
          weatherLocation: {
            type: String,
          }
        }
      }

      constructor() { 
        super();

        this.addEventListener('location-selector.new-location', (event) => this._onNewLocation(event));
        this.addEventListener('location-selector.locate-error', (event) => this._onLocateError(event));

        this.addEventListener('forecast-data.new-place', (event) => this._onNewPlace(event));
        this.addEventListener('wind-now.toggle-wind', (event) => this._onToggleWind(event));

      }

      _onNewLocation(event) {
        this.weatherLocation = event.detail;
        this.locationChanged = !this.locationChanged;
      }

      _onLocateError(event) {
        this.$.locateError.show({text: event.detail.text});
      }

      _onNewPlace(event) {
        this.place = event.detail.place;
        this.locationChanged = !this.locationChanged; 
      }

      _onToggleWind(event) {
        this.showWind = !this.showWind;
      }
    }

    window.customElements.define(WeatherApp.is, WeatherApp);
  </script>
</dom-module>
